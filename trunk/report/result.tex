\section{Hva prosjektet endte opp med}

	Etter implementasjonen endte vi opp med en adaptiv løsning. I tillegg til å kunne bruke HD-kameraet kan det brukes Nintendo Wiimotes. Systemet tilbyr virtuell virkelighet etter kravspesifikasjonen, og støtter følgende konfigurasjoner:
	
	\begin{itemize}
		\item Et HD-kamera som filmer to lys på hodet
		\item En Wiimote som filmer to lys på hodet
		\item To Wiimotes som filmer ett lys på hodet
	\end{itemize}
	
	Felles for alle er at et eller flere kamera (Wiimote eller HD-kamera) filmer lys montert på hodet. Programvaren bruker disse bildene til å estimere posisjonen til hodet i rommet.
	
	\begin{description}
		\item[Et HD-kamera som filmer to lys på hodet] Her er det et HD-kamera som filmer to infrarøde LEDs på hodet til brukeren. I denne konfigurasjonen følger systemet designen beskrevet i designseksjonen over til punkt og prikke.
		\item[En Wiimote som filmer to lys på hodet] I denne konfigurasjonen er HD-kameraet byttet ut med en Nintendo Wiimote som også tar seg av å finne koordinatene til lyspunktene i bildet som filmes. Disse koordinatene sendes trådløst til vår programvare hvor de brukes til å beregne hodeposisjon og vise en 3D-scene akkurat som i konfigurasjonen over.
		\item[To Wiimotes som filmer ett lys på hodet] I denne konfigurasjonen brukes {\em to} Wiimotes. Dette betyr at kun ett lys trengs på hodet.
	\end{description}

    \subsection{Demonstrasjonsprogrammer}
    En av målsetningene til prosjektgruppa var å produsere en eller flere demonstrasjonsprogrammer
    som viser hvordan hodetracking kan brukes.
    \subsubsection{Illusjonen}
        \begin{figure}[h]
	\centering
	\includegraphics[width=0.80\textwidth]{graphics/Illusjonen.jpg}
	\caption{Illustrasjon illusjon}
	\label{fig:illusjon}
	\end{figure}
    Johnny Chung demonstrerer i en video på youtube
    hvordan man kan få et objekt til å tilsynelatende bryte skjermflaten og sveve ut i rommet foran skjermen.
    Denne illusjonen ble gjenskapt i produktet. Hvordan denne effekten oppstår kan kanskje en psykolog forklare
    best, men rent teknisk oppnås denne effekten ved å angi dybden til nærplanet/klippeplanet, som nærmere enn
    starten på grid-rommet og benytte en perspektivprojeksjonen som gjør at grid-rommet er kant-i-kant med skjermen.
    Et objekt som befinner seg lenger frem enn skjermkantene vil da likevel tegnes på grunn av et nærmere nærplan.
    I demonstrasjonen tegnes en linje fra bakveggen i rommet til objektet, sammenligner man denne linjen med linjene
    i grid-rommet vil man se at linjen til objektet later til å være lenger, og dette forsterker inntrykket av at
    objektet er lenger ut i rommet enn skjermflaten. 
    Følgende ligninger brukes for å regne ut et nærmere nærplan. Se også figur \ref{fig:illusjon}.
    Definer $d$ som dybden til ønsket nærplan.

	
    \begin{eqnarray}
    &p_{min} = d\frac{b-x}{z}\\
    &p_{max} = d\frac{a-x}{z}
    \end{eqnarray}
    For y-aksen gjelder figur og ligninger med x utbyttet med y.


	
	\subsubsection{Spillet}
	For å få en engasjerende og morsom demonstrasjon valgte vi å implementere et spill som består av et virtuelt rom
	hvor forskjellige gjenstander beveger seg mot spilleren. Dette kan sammenlignes med TV-underholdningsprogrammet "Ylvis møter veggen"
	hvor deltagerne prøver å komme seg igjennom en form i en vegg. Hodetracking gir oss en indikasjon på hvor spilleren befinner seg,
	dette kan brukes til å bestemme om spilleren kolliderer med eller unngår solide objekter. Spilleren må hoppe over, dukke under og
	løpe til siden av objekter for å unngå kollisjon. Poengsummen bestemmes av hvor lenge spilleren har klart å unngå
	objektene, som kommer flyvende imot både i økende antall og med økende hastighet. Dette gir et meget godt bilde på
	hvordan et spill blir mer engasjerende når spilleren ikke sitter tilnærmet passiv i godstolen, men må opp og røre på seg
	for å få en god score.


\section{Evaluering av resultatet}
	
	Løsningen vi endte opp med følger kravspesifikasjonene og designen. Den estimerer posisjonen til hodet ved å filme infrarøde LEDs montert på hodet, og bruker denne til å skape en virtuell virkelighet på skjermen foran brukeren. Vi starter evaluering ved å påpeke svakhetene ved systemet, og avslutter med styrkene.
	
	\subsection{Svakheter ved systemet}
		\subsubsection{HD-kameraet har forsinkelse}
		
			Når systemet endelig var kapabelt til å motta bilder fra HD-kameraet og spore lyspunktene ble det klart at det er forsinkelse på disse bildene. Denne forsinkelsen er ca 0,5 sekunder og er i stor grad merkbar. Vi håpet tidligere at forsinkelsen var en eller annen flaskehals som bare eksisterte i den tidlige suboptimale koden vi brukte for å få ting til å fungere, men det ser ut til at dette er en iboende egenskap ved HD-kameraet og/eller overføringen av bildene gjennom HDMI-kortet. Siden kameraet har høy oppløsning er det mange piksler som skal sendes. I tillegg til dette er kameraet ikke beregnet for sanntidsfilming, men heller å ta opp for å se senere. Heldigvis er Wiimotesene beregnet på denne bruken og har neglisjerbar forsinkelse.
		
		\subsubsection{LED-headsettet er ikke profesjonelt}
		I forhold til Nintendo sensorbar er ikke headsettet en like god lyskilde.
		Nintendo senorbare har en vifteform av LED's samt en skikkelig lysspreder(diffusjonsglass).
		
		Selv om det for prosjektgruppa er sjarmerende med et headsett som har synlige røde og sorte
		ledninger, med kledelig sort elektrikerteip, er dette ikke like betryggende for de personene som tester systemet.
			
	
	\subsection{Styrker ved systemet}
	
		\subsubsection{HD-kamera har høy oppløsning}
		
			HD-kameraets høye oppløsning gjør at små LEDs synes på lang avstand. Dette betyr at man kan stå langt unna kameraet, og dermed også langt unna skjermen, og fortsatt oppleve god respons på hodebevegelser. Aberet er at høyere oppløsning betyr flere piksler å prosessere i søk etter lysprikkene, men dette ser ikke ut til å være den største flaskehalsen med de nåværende algoritmene.
		
		
			
		
		\subsubsection{Virkelighetsfølelsen er sterk}
		
			Det finnes mange ulike systemer for virtuell virkelighet. Virkemidlene de bruker for å oppnå denne illusjonen varierer sterkt, og ingen dekker alle sansene på en gang. Vårt system simulerer virkningene av å bevege hodet når man ser på noe. Dette gir en sterk virkelighetsfølelse fordi hjernen kobler sammen hvordan kroppen beveger seg med hva den ser. For at hjernen skal tro at den ser på et 3-dimensjonal objekt må synet matche bevegelsene, og det gjør de i vårt system.
	 \subsection{Testresultater (Vegar)}
    For å få et inntrykk av nøyaktigheten til posisjoneringen merket vi opp avstander i et rom, kalibrerte program og utstyr og
    foretok målinger på de oppmerkede punktene.
    
    Følgende tabell viser nøyaktigheten til systemet ved bruk av henholdsvis en sensor(kuleskallmodell) og to sensorer(triangulering).
    
    \includegraphics[width=1.25\textwidth]{graphics/testresults.pdf}
    
    Følgende feilkilder må tas med i tolkningen av resultatet.
    \begin{enumerate}
    \item Avstandsoppmerkingen ble gjort med tommestokk, og er nøyaktig innenfor et par centimeter.
    \item Ved bruk av en sensor, er det ikke alltid at hodet er vendt nøyaktig vinkelrett på sensor, slik som modellen antar.
    \item Målepunktene med stor x-verdi er veldig nært maksimal utsynsvinkel for sensor.
    \end{enumerate}
	
	Det mest åpenbare resultatet er at gjennomsnittlig absolutt avvik er mindre ved bruk av triangulering. 
	Det er verdt å merke seg at de største avvikene er i måleposisjonen med stor x-verdi(langt ut til siden),
	og det er sannsynlig at målepunktet er på grensen av hva utstyret klarer å observere. Kuleskallmodellen
	får en uvanlig høy feil ved x-verdi -100, og dette kan skyldes støy fra andre infrarøde kilder som belysning og lignende.
	
	Resultatet er i tråd med gruppas forventning siden triangulering ikke gjør antagelser om hoderotasjonen til brukeren og
	eliminerer derfor en feilkilde.
    
    
    \subsection{Sammenligning med andre}
    Før og i  løpet av prosjektet har prosjektgruppa merket seg og blitt inspirert av andre som har implementert lignende
    løsninger. Av disse har vi sett på videomateriale fra tidligere VR-landsbyer, samt Johnny Chung Lee, Ph.D ved Carnegie Mellon University.
    Prosjektetgruppas hovedmål har hele tiden vært at produktet skal være en god teknologisk løsning på headtracking.
    Sammenlignet med disse er det prosjektgruppas mening at Virins er en like god eller bedre teknologisk løsning.
    To egenskaper ved Virins er stor bevegelsesfrihet, samt to former(modi) for bestemmelse av hodeposisjon begge med eksakt løsning på lukket form.

    Følgende er noen karakteristika for Virins.

    \begin{tabular}{| p{0.4\textwidth} | p{0.4\textwidth} | }
    \hline
      Programmeringsspråk   & Java\\
    \hline
      Plattformuavhengig    & Ja(OpenGL, Java)\\
    \hline
      Sensor                & Wiimote eller kamera\\
    \hline
      Modi                  & 1. To wiimotes og triangulering 2. En wiimote eller kamera og kuleskall. Begge med eksakt beregninsmodell \\
    \hline  
    \end{tabular}

    Det bør nevnes at rammeverket ble bestemt å skulle ta i bruk Java Media Framework(JMF), siden dette er tilgjengelig på flere plattformer. JMF er et bibliotek for mediaprosessering, og tilbyr et enkelt grensesnitt for å få tilgang til video.
    For å få tilgang til HDMI capture kortet ble vi nødt til å bruke et plattformspesifikt bibliotek for directshow, da HDMI capture kortet ikke var tilgjengelig ved bruk av JMF. Vanlige webkameraer ble testet og fungerte ved bruk av JMF, og rammeverket støtter
    videokilder som er tilgjengelige gjennom JMF.  Rammeverket er derfor plattformuavhengig både ved bruk av Wiimotes og kamera, med mulighet til
    å bruke et plattformspesifikt bibliotek for mer eksotiske videokilder som HDMI capture kort.

\section{Konklusjon}
	
	Problemstillingen vår var om det mulig å lage en rimelig og brukbar løsning for tracking av hode til bruk i VR. Vi mener at løsningen vi har utviklet er et svar på denne problemstillingen. Og svaret er "ja". Komponentene som brukes er under 10 000 NOK tilsammen, og kan byttes ut med enda billigere typer. For eksempel kan HD-kamera til 6000 NOK byttes ut med webkamera til 1000 NOK uten problemer. Ved bruk av Wiimotes kommer man også godt under 1000 NOK. Systemet fungerer og gir en virtuell virkelighetsfølelse. Videre er den enkel å bruke og konfigurere.

\section{Videre arbeid}
	
	Systemet vi har laget bør ses på som en prototype eller proof-of-concept. Det er mange forbedringsmuligheter. HD-kameraet bør byttes ut med et kamera med neglisjerbar forsinkelse, men som fortsatt har høy oppløsning. Et høytoppløst webcamera foreslås som mulig kandidat. Eventuelt kan man kun bruke Wiimotes, ettersom disse har gitt gode resultater.
	
	Headsettet bør forbedres slik at LEDsene lyser i alle retninger og slik at batteriet varer lenger. En løsning kan være å koble til en Wii sensorbar til et batteripakke på hodet. Sensorbaren har flere LEDs samlet sammen pekende i en fane utover. Dette gir god spredning og kraftig lysstyrke.
	
	Et forslag til hvordan konseptet kan dras videre er å montere mange (4-10) Wiimotes rundt i et stort rom og beregne hodeposisjonen ut fra alle dataene disse fanger opp. Så lenge minst to av disse ser lyset vil det være nok for å beregne dets posisjon. Om flere ser lyset vil estimeringen bare bli mer nøyaktig. Ved å f.eks. plassere Wiimotesene i hjørnene vil hele rommet være dekket, og man har full frihet til å bevege seg.
	
	Hvis man har en stereoskopisk skjerm, kan dette benyttes til å gi en mye bedre dybdefølelse enn hva som gis av illusjonsdemonstrasjonen.
	En annen mulighet er å bruke en stereoskopisk skjerm til å la to spillere spille samtidig. Ved at den ene spilleren bruker briller
	med annen polarisering enn den andre spilleren kan begge få et individuelt perspektiv i spillet. En mulighet er å bruke trianguleringsmodus,
	slik at begge spillerne har et infrarødt lys hver på hodet som trackes uavhengig.
